<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÄÄƒng kÃ½ tham gia | CLB Event</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Montserrat', sans-serif; background-color: #f8f9fa; margin: 0; }
        .banner {
            background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('https://images.pexels.com/photos/1181406/pexels-photo-1181406.jpeg');
            background-size: cover; background-position: center; color: white; padding: 60px 0; text-align: center;
        }
        .card-custom { border: none; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .ticket-box { background: #f1f3f5; border: 2px dashed #1e3c72; border-radius: 10px; padding: 15px; margin-top: 15px; }
        
        #loader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #1e3c72; display: flex; justify-content: center; align-items: center; z-index: 9999; transition: opacity 0.5s ease; }
        .spinner { width: 50px; height: 50px; border: 5px solid rgba(255,255,255,0.3); border-radius: 50%; border-top-color: #fff; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loader-hidden { opacity: 0; visibility: hidden; }
        
        @media (max-width: 576px) { .banner { padding: 40px 0; } .card-custom { margin: 0 10px; } }
    </style>
</head>

<body>
<div id="loader"><div class="spinner"></div></div>

<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container">
    <a class="navbar-brand fw-bold d-flex align-items-center" href="index.html">
        <img src="logo.png" alt="Logo" style="height: 35px; margin-right: 10px;">
        <span class="d-none d-sm-inline">CLB Event Manager</span>
    </a>
    <div class="ms-auto d-flex">
        <a class="nav-link text-white me-3" href="checkin-guest.html">Tá»± Check-in</a>
        <a class="nav-link text-warning" href="index.html">ThoÃ¡t</a>
    </div>
  </div>
</nav>

<section class="banner">
  <div class="container">
    <h1 class="fw-bold">ÄÄƒng kÃ½ tham gia</h1>
    <p class="lead">Nháº­n vÃ© QR ngay sau khi hoÃ n táº¥t</p>
  </div>
</section>

<div class="container my-5">
  <div class="row justify-content-center">
    <div class="col-md-6 col-lg-5">
      <div class="card card-custom p-4">
        <h3 class="mb-4 text-center fw-bold text-primary">ğŸ“ ThÃ´ng tin cÃ¡ nhÃ¢n</h3>

        <div class="mb-3">
          <label class="form-label fw-semibold">Sá»± kiá»‡n</label>
          <select id="eventId" class="form-select border-primary form-control-lg">
            <option value="">Äang táº£i danh sÃ¡ch...</option>
          </select>
        </div>

        <div class="mb-3">
          <label class="form-label fw-semibold">Há» vÃ  tÃªn</label>
          <input id="fullname" class="form-control form-control-lg" placeholder="VÃ­ dá»¥: Nguyá»…n VÄƒn A">
        </div>

        <div class="row">
          <div class="col-6 mb-3">
            <label class="form-label fw-semibold">KhÃ³a</label>
            <input id="course" class="form-control" placeholder="K50...">
          </div>
          <div class="col-6 mb-3">
            <label class="form-label fw-semibold">Giá»›i tÃ­nh</label>
            <select id="gender" class="form-select">
              <option value="Nam">Nam</option>
              <option value="Ná»¯">Ná»¯</option>
            </select>
          </div>
        </div>

        <div class="mb-4">
          <label class="form-label fw-semibold">Email sinh viÃªn</label>
          <input id="email" type="email" class="form-control form-control-lg" placeholder="email@sinhvien.edu.vn">
        </div>

        <button class="btn btn-primary w-100 fw-bold py-3 shadow" onclick="handleUserRegistration()">
          ğŸŸ ÄÄ‚NG KÃ NHáº¬N VÃ‰
        </button>

        <div id="qr-container" class="text-center mt-4" style="display:none;">
          <hr>
          <p class="text-success fw-bold mb-2">ğŸ‰ ÄÄ‚NG KÃ THÃ€NH CÃ”NG!</p>
          <img id="qr" src="" class="img-fluid rounded shadow-sm border mb-3" style="width: 200px;">
          
          <div class="ticket-box">
              <p class="small text-muted mb-1 text-uppercase fw-bold">MÃ£ vÃ© cá»§a báº¡n</p>
              <h3 id="ticketCodeDisplay" class="fw-bold text-dark mb-0" style="letter-spacing: 2px;"></h3>
          </div>
          <p class="small text-muted mt-3 italic">Chá»¥p mÃ n hÃ¬nh láº¡i Ä‘á»ƒ check-in nhÃ©!</p>
        </div>
      </div>
    </div>
  </div>
</div>

<footer class="text-center py-4 text-muted border-top">
    Â© 2026 CLB Event Manager
</footer>

<script>
    window.addEventListener("load", () => {
        setTimeout(() => document.getElementById("loader").classList.add("loader-hidden"), 500);
    });
    document.addEventListener("DOMContentLoaded", () => {
        fetch('/api/events')
            .then(res => res.json())
            .then(data => {
                const select = document.getElementById("eventId");
                if (data.length === 0) {
                    select.innerHTML = '<option value="">KhÃ´ng cÃ³ sá»± kiá»‡n diá»…n ra</option>';
                } else {
                    select.innerHTML = data.map(ev => `<option value="${ev.id}">${ev.name}</option>`).join('');
                }
            });
    });

    function handleUserRegistration() {
        const fullname = document.getElementById("fullname").value;
        const email = document.getElementById("email").value;
        const eventId = document.getElementById("eventId").value;
        const loader = document.getElementById("loader");

        if (!fullname || !email || !eventId) {
            alert("Vui lÃ²ng Ä‘iá»n Ä‘á»§ tÃªn, email vÃ  chá»n sá»± kiá»‡n nhÃ©!");
            return;
        }

        loader.classList.remove("loader-hidden");

        fetch('/api/register', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                fullname, 
                gender: document.getElementById("gender").value,
                course: document.getElementById("course").value,
                email, 
                eventId 
            })
        })
        .then(res => res.json())
        .then(data => {
            loader.classList.add("loader-hidden");
            if (data.qr) {
                document.getElementById("qr").src = data.qr;
                document.getElementById("ticketCodeDisplay").innerText = data.ticket;
                document.getElementById("qr-container").style.display = "block";
                document.getElementById("qr-container").scrollIntoView({ behavior: 'smooth' });
                alert("ÄÄƒng kÃ½ thÃ nh cÃ´ng!");
            }
        })
        .catch(err => {
            loader.classList.add("loader-hidden");
            alert("Lá»—i káº¿t ná»‘i server Render!");
        });
    }
</script>
</body>
</html>

