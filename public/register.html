<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CLB Event Manager | ÄÄƒng kÃ½</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Montserrat', sans-serif; background-color: #f8f9fa; margin: 0; }
    .banner {
      background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('https://images.pexels.com/photos/1181406/pexels-photo-1181406.jpeg');
      background-size: cover; background-position: center; color: white; padding: 80px 0; text-align: center;
    }
    .card-custom { border: none; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }

    #loader {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: #1e3c72; display: flex; justify-content: center; align-items: center;
        z-index: 9999; transition: opacity 0.5s ease, visibility 0.5s;
    }
    .spinner { width: 50px; height: 50px; border: 5px solid rgba(255,255,255,0.3); border-radius: 50%; border-top-color: #fff; animation: spin 1s linear infinite; }
    @keyframes spin { to { tranform: rotate(360deg); } }
    .loader-hidden { opacity: 0; visibility: hidden; }
  </style>
</head>

<body>
<div id="loader">
    <div class="spinner"></div>
</div>

<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container">
    <a class="navbar-brand fw-bold" href="index.html">ğŸ‰ CLB Event Manager</a>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link active" href="register.html">ÄÄƒng kÃ½</a></li>
        <li class="nav-item"><a class="nav-link" href="checkin-guest.html">Tá»± Check-in</a></li>
        <li class="nav-item"><a class="nav-link" href="feedback.html">GÃ³p Ã½</a></li>
        <li class="nav-item"><a class="nav-link text-warning" href="index.html">Quay láº¡i Portal</a></li>
      </ul>
    </div>
  </div>
</nav>

<section class="banner">
  <div class="container">
    <h1 class="fw-bold">ÄÄƒng kÃ½ tham gia</h1>
    <p class="lead">Nhanh chÃ³ng â€“ Ä‘Æ¡n giáº£n â€“ nháº­n vÃ© QR ngay</p>
  </div>
</section>

<div class="container my-5">
  <div class="row justify-content-center"><!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CLB Event Manager | ÄÄƒng kÃ½</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Montserrat', sans-serif; background-color: #f8f9fa; margin: 0; }
    .banner {
      background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('https://images.pexels.com/photos/1181406/pexels-photo-1181406.jpeg');
      background-size: cover; background-position: center; color: white; padding: 80px 0; text-align: center;
    }
    .card-custom { border: none; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }

    #loader {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: #1e3c72; display: flex; justify-content: center; align-items: center;
        z-index: 9999; transition: opacity 0.5s ease, visibility 0.5s;
    }
    .spinner { width: 50px; height: 50px; border: 5px solid rgba(255,255,255,0.3); border-radius: 50%; border-top-color: #fff; animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .loader-hidden { opacity: 0; visibility: hidden; }
    
    /* Hiá»‡u á»©ng cho pháº§n hiá»ƒn thá»‹ mÃ£ vÃ© */
    .ticket-box {
        background: #f1f3f5;
        border: 2px dashed #1e3c72;
        border-radius: 10px;
        padding: 15px;
        margin-top: 15px;
    }
  </style>
</head>

<body>
<div id="loader">
    <div class="spinner"></div>
</div>

<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container">
    <a class="navbar-brand fw-bold" href="index.html">ğŸ‰ CLB Event Manager</a>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link active" href="register.html">ÄÄƒng kÃ½</a></li>
        <li class="nav-item"><a class="nav-link" href="checkin-guest.html">Tá»± Check-in</a></li>
        <li class="nav-item"><a class="nav-link" href="feedback.html">GÃ³p Ã½</a></li>
        <li class="nav-item"><a class="nav-link text-warning" href="index.html">Quay láº¡i Portal</a></li>
      </ul>
    </div>
  </div>
</nav>

<section class="banner">
  <div class="container">
    <h1 class="fw-bold">ÄÄƒng kÃ½ tham gia</h1>
    <p class="lead">Nhanh chÃ³ng â€“ Ä‘Æ¡n giáº£n â€“ nháº­n vÃ© QR ngay</p>
  </div>
</section>

<div class="container my-5">
  <div class="row justify-content-center">
    <div class="col-md-6 col-lg-5">
      <div class="card card-custom p-4">
        <h3 class="mb-4 text-center fw-bold text-primary">ğŸ“ ThÃ´ng tin Ä‘Äƒng kÃ½</h3>

        <div class="mb-3">
          <label class="form-label fw-semibold">Chá»n sá»± kiá»‡n tham gia</label>
          <select id="eventId" class="form-select border-primary">
            <option value="">Äang táº£i danh sÃ¡ch sá»± kiá»‡n...</option>
          </select>
        </div>

        <div class="mb-3">
          <label class="form-label fw-semibold">Há» vÃ  tÃªn</label>
          <input id="fullname" class="form-control" placeholder="Nguyá»…n VÄƒn A">
        </div>

        <div class="row">
          <div class="col-6 mb-3">
            <label class="form-label fw-semibold">Giá»›i tÃ­nh</label>
            <select id="gender" class="form-select">
              <option value="Nam">Nam</option>
              <option value="Ná»¯">Ná»¯</option>
            </select>
          </div>
          <div class="col-6 mb-3">
            <label class="form-label fw-semibold">KhÃ³a há»c</label>
            <input id="course" class="form-control" placeholder="K50, K51...">
          </div>
        </div>

        <div class="mb-4">
          <label class="form-label fw-semibold">Email sinh viÃªn</label>
          <input id="email" type="email" class="form-control" placeholder="email@sinhvien.edu.vn">
        </div>

        <button class="btn btn-primary w-100 fw-bold py-2 shadow" onclick="handleUserRegistration()">
          ğŸŸ ÄÄ‚NG KÃ NHáº¬N VÃ‰
        </button>

        <div id="qr-container" class="text-center mt-4" style="display:none;">
          <hr>
          <p class="text-success fw-bold mb-2">ğŸ‰ ÄÄƒng kÃ½ thÃ nh cÃ´ng!</p>
          
          <img id="qr" src="" class="img-fluid rounded shadow-sm border mb-3" style="width: 200px; display: none;">
          
          <div class="ticket-box">
              <p class="small text-muted mb-1 text-uppercase fw-bold">MÃ£ vÃ© cá»§a báº¡n</p>
              <h3 id="ticketCodeDisplay" class="fw-bold text-dark mb-0" style="letter-spacing: 2px;"></h3>
          </div>
          
          <p class="small text-muted mt-3">HÃ£y chá»¥p mÃ n hÃ¬nh láº¡i Ä‘á»ƒ lÃ m thá»§ tá»¥c check-in nhÃ©!</p>
        </div>
      </div>
    </div>
  </div>
</div>

<footer class="text-center py-4 mt-5 text-muted border-top">
  Â© 2026 CLB Event Manager â€“ Agile Project
</footer>

<script>
    window.addEventListener("load", function() {
        setTimeout(() => {
            document.getElementById("loader").classList.add("loader-hidden");
        }, 500);
    });

    document.addEventListener("DOMContentLoaded", function() {
        fetch('/api/events')
            .then(res => res.json())
            .then(data => {
                const select = document.getElementById("eventId");
                if (data.length === 0) {
                    select.innerHTML = '<option value="">KhÃ´ng cÃ³ sá»± kiá»‡n nÃ o Ä‘ang diá»…n ra</option>';
                } else {
                    select.innerHTML = data.map(ev => `<option value="${ev.id}">${ev.name}</option>`).join('');
                }
            });
    });

    function handleUserRegistration() {
        const fullname = document.getElementById("fullname").value;
        const gender = document.getElementById("gender").value;
        const course = document.getElementById("course").value;
        const email = document.getElementById("email").value;
        const eventId = document.getElementById("eventId").value;

        if (!fullname || !email || !eventId) {
            alert("Nháº¯c báº¡n: HÃ£y Ä‘iá»n Ä‘áº§y Ä‘á»§ tÃªn, email vÃ  chá»n sá»± kiá»‡n nhÃ©!");
            return;
        }

        // Hiá»‡n láº¡i loader Ä‘á»ƒ táº¡o cáº£m giÃ¡c há»‡ thá»‘ng Ä‘ang xá»­ lÃ½
        document.getElementById("loader").classList.remove("loader-hidden");

        fetch('/api/register', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ fullname, gender, course, email, eventId })
        })
        .then(res => res.json())
        .then(data => {
            // áº¨n loader
            document.getElementById("loader").classList.add("loader-hidden");

            if (data.qr) {
                const qrContainer = document.getElementById("qr-container");
                const qrImg = document.getElementById("qr");
                const ticketText = document.getElementById("ticketCodeDisplay");
                
                // Äá»• dá»¯ liá»‡u QR
                qrImg.src = data.qr;
                qrImg.style.display = "inline-block";
                
                // Äá»• dá»¯ liá»‡u MÃ£ vÃ© chá»¯
                ticketText.innerText = data.ticket; // Giáº£ sá»­ server tráº£ vá» field "ticket"
                
                qrContainer.style.display = "block";
                
                // Cuá»™n xuá»‘ng Ä‘á»ƒ xem mÃ£ vÃ©
                qrContainer.scrollIntoView({ behavior: 'smooth' });
                
                alert("ÄÄƒng kÃ½ thÃ nh cÃ´ng! HÃ£y lÆ°u láº¡i mÃ£ vÃ© nhÃ©.");
            }
        })
        .catch(err => {
            document.getElementById("loader").classList.add("loader-hidden");
            alert("Lá»—i káº¿t ná»‘i server!");
        });
    }
</script>

</body>
</html>
    <div class="col-md-6 col-lg-5">
      <div class="card card-custom p-4">
        <h3 class="mb-4 text-center fw-bold text-primary">ğŸ“ ThÃ´ng tin Ä‘Äƒng kÃ½</h3>

        <div class="mb-3">
          <label class="form-label fw-semibold">Chá»n sá»± kiá»‡n tham gia</label>
          <select id="eventId" class="form-select border-primary">
            <option value="">Äang táº£i danh sÃ¡ch sá»± kiá»‡n...</option>
          </select>
        </div>

        <div class="mb-3">
          <label class="form-label fw-semibold">Há» vÃ  tÃªn</label>
          <input id="fullname" class="form-control" placeholder="Nguyá»…n VÄƒn A">
        </div>

        <div class="row">
          <div class="col-6 mb-3">
            <label class="form-label fw-semibold">Giá»›i tÃ­nh</label>
            <select id="gender" class="form-select">
              <option value="Nam">Nam</option>
              <option value="Ná»¯">Ná»¯</option>
            </select>
          </div>
          <div class="col-6 mb-3">
            <label class="form-label fw-semibold">KhÃ³a há»c</label>
            <input id="course" class="form-control" placeholder="K50, K51...">
          </div>
        </div>

        <div class="mb-4">
          <label class="form-label fw-semibold">Email sinh viÃªn</label>
          <input id="email" type="email" class="form-control" placeholder="email@sinhvien.edu.vn">
        </div>

        <button class="btn btn-primary w-100 fw-bold py-2 shadow" onclick="handleUserRegistration()">
          ğŸŸ ÄÄ‚NG KÃ NHáº¬N VÃ‰
        </button>

        <div id="qr-container" class="text-center mt-4" style="display:none;">
          <hr>
          <p class="text-success fw-bold mb-2">ğŸ‰ ÄÄƒng kÃ½ thÃ nh cÃ´ng!</p>
          <p class="small text-muted mb-3">Vui lÃ²ng chá»¥p mÃ n hÃ¬nh vÃ© QR bÃªn dÆ°á»›i</p>
          <img id="qr" src="" class="img-fluid rounded shadow-sm border" style="width: 200px;">
        </div>
      </div>
    </div>
  </div>
</div>

<footer class="text-center py-4 mt-5 text-muted border-top">
  Â© 2026 CLB Event Manager â€“ Agile Project
</footer>

<script>
    window.addEventListener("load", function() {
        setTimeout(() => {
            document.getElementById("loader").classList.add("loader-hidden");
        }, 500);
    });
    document.addEventListener("DOMContentLoaded", function() {
        fetch('/api/events')
            .then(res => res.json())
            .then(data => {
                const select = document.getElementById("eventId");
                if (data.length === 0) {
                    select.innerHTML = '<option value="">KhÃ´ng cÃ³ sá»± kiá»‡n nÃ o Ä‘ang diá»…n ra</option>';
                } else {
                    select.innerHTML = data.map(ev => `<option value="${ev.id}">${ev.name}</option>`).join('');
                }
            });
    });
    function handleUserRegistration() {
    const fullname = document.getElementById("fullname").value;
    const email = document.getElementById("email").value;
    const eventId = document.getElementById("eventId").value;

    if (!fullname || !email || !eventId) {
        alert("Lá»™c nháº¯c: Vui lÃ²ng Ä‘iá»n Ä‘á»§ tÃªn, email vÃ  chá»n sá»± kiá»‡n!");
        return;
    }

    // Hiá»‡n láº¡i loader khi Ä‘ang Ä‘Äƒng kÃ½
    document.getElementById("loader").classList.remove("loader-hidden");

    fetch('/api/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
            fullname, 
            gender: document.getElementById("gender").value,
            course: document.getElementById("course").value,
            email, 
            eventId 
        })
    })
    .then(res => res.json())
    .then(data => {
        document.getElementById("loader").classList.add("loader-hidden");

        if (data.qr) {
            const qrContainer = document.getElementById("qr-container");
            const qrImg = document.getElementById("qr");
            const ticketText = document.getElementById("ticketCodeDisplay");
            qrImg.src = data.qr;
            qrImg.style.display = "inline-block";
            if (ticketText) {
                ticketText.innerText = data.ticket; 
            }
            
            qrContainer.style.display = "block";
            qrContainer.scrollIntoView({ behavior: 'smooth' }); 
            alert("ÄÄƒng kÃ½ thÃ nh cÃ´ng! HÃ£y lÆ°u láº¡i mÃ£ vÃ© nhÃ©.");
        } else {
            alert("Lá»—i server: " + (data.message || "KhÃ´ng thá»ƒ táº¡o vÃ©"));
        }
    })
    .catch(err => {
        document.getElementById("loader").classList.add("loader-hidden");
        console.error("Lá»—i Ä‘Äƒng kÃ½:", err);
        alert("Lá»—i káº¿t ná»‘i server rá»“i Lá»™c Æ¡i!");
    });
}
</script>

</body>
</html>




