<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CLB Event Manager | ÄÄƒng kÃ½</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Montserrat', sans-serif; background-color: #f8f9fa; margin: 0; }
    .banner {
      background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url('https://images.pexels.com/photos/1181406/pexels-photo-1181406.jpeg');
      background-size: cover; background-position: center; color: white; padding: 80px 0; text-align: center;
    }
    .card-custom { border: none; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
    
    /* CSS cho hiá»‡u á»©ng Loading */
    #loader {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: #1e3c72; display: flex; justify-content: center; align-items: center;
        z-index: 9999; transition: opacity 0.5s ease, visibility 0.5s;
    }
    .spinner { width: 50px; height: 50px; border: 5px solid rgba(255,255,255,0.3); border-radius: 50%; border-top-color: #fff; animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .loader-hidden { opacity: 0; visibility: hidden; }
  </style>
</head>

<body>
<div id="loader">
    <div class="spinner"></div>
</div>

<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container">
    <a class="navbar-brand fw-bold" href="index.html">ğŸ‰ CLB Event Manager</a>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link active" href="register.html">ÄÄƒng kÃ½</a></li>
        <li class="nav-item"><a class="nav-link" href="checkin-guest.html">Tá»± Check-in</a></li>
        <li class="nav-item"><a class="nav-link" href="feedback.html">GÃ³p Ã½</a></li>
        <li class="nav-item"><a class="nav-link text-warning" href="index.html">Quay láº¡i Portal</a></li>
      </ul>
    </div>
  </div>
</nav>

<section class="banner">
  <div class="container">
    <h1 class="fw-bold">ÄÄƒng kÃ½ tham gia</h1>
    <p class="lead">Nhanh chÃ³ng â€“ Ä‘Æ¡n giáº£n â€“ nháº­n vÃ© QR ngay</p>
  </div>
</section>

<div class="container my-5">
  <div class="row justify-content-center">
    <div class="col-md-6 col-lg-5">
      <div class="card card-custom p-4">
        <h3 class="mb-4 text-center fw-bold text-primary">ğŸ“ ThÃ´ng tin Ä‘Äƒng kÃ½</h3>

        <div class="mb-3">
          <label class="form-label fw-semibold">Chá»n sá»± kiá»‡n tham gia</label>
          <select id="eventId" class="form-select border-primary">
            <option value="">Äang táº£i danh sÃ¡ch sá»± kiá»‡n...</option>
          </select>
        </div>

        <div class="mb-3">
          <label class="form-label fw-semibold">Há» vÃ  tÃªn</label>
          <input id="fullname" class="form-control" placeholder="Nguyá»…n VÄƒn A">
        </div>

        <div class="row">
          <div class="col-6 mb-3">
            <label class="form-label fw-semibold">Giá»›i tÃ­nh</label>
            <select id="gender" class="form-select">
              <option value="Nam">Nam</option>
              <option value="Ná»¯">Ná»¯</option>
            </select>
          </div>
          <div class="col-6 mb-3">
            <label class="form-label fw-semibold">KhÃ³a há»c</label>
            <input id="course" class="form-control" placeholder="K50, K51...">
          </div>
        </div>

        <div class="mb-4">
          <label class="form-label fw-semibold">Email sinh viÃªn</label>
          <input id="email" type="email" class="form-control" placeholder="email@sinhvien.edu.vn">
        </div>

        <button class="btn btn-primary w-100 fw-bold py-2 shadow" onclick="handleUserRegistration()">
          ğŸŸ ÄÄ‚NG KÃ NHáº¬N VÃ‰
        </button>

        <div id="qr-container" class="text-center mt-4" style="display:none;">
          <hr>
          <p class="text-success fw-bold mb-2">ğŸ‰ ÄÄƒng kÃ½ thÃ nh cÃ´ng!</p>
          <p class="small text-muted mb-3">Vui lÃ²ng chá»¥p mÃ n hÃ¬nh vÃ© QR bÃªn dÆ°á»›i</p>
          <img id="qr" src="" class="img-fluid rounded shadow-sm border" style="width: 200px;">
        </div>
      </div>
    </div>
  </div>
</div>

<footer class="text-center py-4 mt-5 text-muted border-top">
  Â© 2026 CLB Event Manager â€“ Agile Project
</footer>

<script>
    // 1. Tá»± áº©n Loader khi vÃ o trang
    window.addEventListener("load", function() {
        setTimeout(() => {
            document.getElementById("loader").classList.add("loader-hidden");
        }, 500);
    });

    // 2. Tá»± Ä‘á»™ng táº£i danh sÃ¡ch sá»± kiá»‡n khi má»Ÿ trang
    document.addEventListener("DOMContentLoaded", function() {
        fetch('/api/events')
            .then(res => res.json())
            .then(data => {
                const select = document.getElementById("eventId");
                if (data.length === 0) {
                    select.innerHTML = '<option value="">KhÃ´ng cÃ³ sá»± kiá»‡n nÃ o Ä‘ang diá»…n ra</option>';
                } else {
                    select.innerHTML = data.map(ev => `<option value="${ev.id}">${ev.name}</option>`).join('');
                }
            });
    });

    // 3. HÃ m xá»­ lÃ½ Ä‘Äƒng kÃ½
    function handleUserRegistration() {
        const fullname = document.getElementById("fullname").value;
        const gender = document.getElementById("gender").value;
        const course = document.getElementById("course").value;
        const email = document.getElementById("email").value;
        const eventId = document.getElementById("eventId").value;

        if (!fullname || !email || !eventId) {
            alert("Lá»™c nháº¯c báº¡n: HÃ£y Ä‘iá»n Ä‘áº§y Ä‘á»§ tÃªn, email vÃ  chá»n sá»± kiá»‡n nhÃ©!");
            return;
        }

        fetch('/api/register', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ fullname, gender, course, email, eventId })
        })
        .then(res => res.json())
        .then(data => {
            if (data.qr) {
                const qrContainer = document.getElementById("qr-container");
                const qrImg = document.getElementById("qr");
                qrImg.src = data.qr;
                qrImg.style.display = "inline-block";
                qrContainer.style.display = "block";
                alert("ÄÄƒng kÃ½ thÃ nh cÃ´ng! HÃ£y lÆ°u láº¡i mÃ£ QR nhÃ©.");
            }
        })
        .catch(err => alert("Lá»—i káº¿t ná»‘i server rá»“i Lá»™c Æ¡i!"));
    }
</script>

</body>
</html>
