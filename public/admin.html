<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n l√Ω s·ª± ki·ªán | Admin Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Montserrat', sans-serif; background-color: #f0f2f5; margin: 0; }
        .table-container { background: white; border-radius: 20px; padding: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        .stat-card { border: none; border-radius: 15px; transition: transform 0.3s; }
        .stat-card:hover { transform: translateY(-5px); }
        
        /* Loader CSS */
        #loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #1e3c72; display: flex; justify-content: center; align-items: center;
            z-index: 9999; transition: opacity 0.5s ease, visibility 0.5s;
        }
        .spinner { width: 50px; height: 50px; border: 5px solid rgba(255,255,255,0.3); border-radius: 50%; border-top-color: #fff; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loader-hidden { opacity: 0; visibility: hidden; }
    </style>
</head>
<body>
    <script>
        if (localStorage.getItem("isAdmin") !== "true") {
            window.location.href = "login.html";
        }
    </script>

    <div id="loader">
        <div class="spinner"></div>
    </div>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
        <div class="container">
            <a class="navbar-brand fw-bold" href="#">üìä ADMIN PANEL</a>
            <div class="ms-auto d-flex align-items-center">
                <a href="create-event.html" class="btn btn-outline-info btn-sm me-2">T·∫°o S·ª± Ki·ªán</a>
                <button class="btn btn-danger btn-sm fw-bold" onclick="logout()">ƒêƒÉng xu·∫•t</button>
            </div>
        </div>
    </nav>

    <div class="container my-4">
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card stat-card bg-primary text-white p-3 mb-3">
                    <h6 class="text-uppercase small fw-bold">T·ªïng s·ªë ƒëƒÉng k√Ω</h6>
                    <h2 id="totalParticipants" class="fw-bold mb-0">0</h2>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card stat-card bg-success text-white p-3 mb-3">
                    <h6 class="text-uppercase small fw-bold">ƒê√£ Check-in</h6>
                    <h2 id="totalCheckedIn" class="fw-bold mb-0">0</h2>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <div class="table-container">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h4 class="fw-bold m-0 text-dark">üë• Danh s√°ch tham gia</h4>
                        <button class="btn btn-sm btn-outline-secondary" onclick="loadParticipants()">L√†m m·ªõi d·ªØ li·ªáu</button>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-hover align-middle">
                            <thead class="table-light">
                                <tr class="small text-uppercase">
                                    <th>H·ªç v√† t√™n</th>
                                    <th>Kh√≥a</th>
                                    <th>Email</th>
                                    <th>Tr·∫°ng th√°i</th>
                                    <th>Ng√†y ƒëƒÉng k√Ω</th>
                                </tr>
                            </thead>
                            <tbody id="participantList">
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="text-center py-4 text-muted">
        ¬© 2026 CLB Event Manager ‚Äì Dashboard d√†nh cho Admin L·ªôc
    </footer>

    <script>
        // 1. T·ª± ·∫©n loader khi v√†o trang
        window.addEventListener("load", function() {
            setTimeout(() => {
                document.getElementById("loader").classList.add("loader-hidden");
            }, 500);
        });

        function logout() {
            localStorage.removeItem("isAdmin");
            window.location.href = "login.html";
        }

        function loadParticipants() {
            fetch('/api/participants')
                .then(res => res.json())
                .then(data => {
                    const tbody = document.getElementById("participantList");
                    const totalEl = document.getElementById("totalParticipants");
                    const checkInEl = document.getElementById("totalCheckedIn");

                    // C·∫≠p nh·∫≠t th·ªëng k√™
                    totalEl.innerText = data.length;
                    checkInEl.innerText = data.filter(p => p.checkedIn).length;

                    // C·∫≠p nh·∫≠t b·∫£ng
                    tbody.innerHTML = data.map(p => `
                        <tr>
                            <td class="fw-semibold text-primary">${p.fullname}</td>
                            <td><span class="badge bg-light text-dark border">${p.course}</span></td>
                            <td class="small">${p.email}</td>
                            <td>
                                <span class="badge ${p.checkedIn ? 'bg-success' : 'bg-warning text-dark'}">
                                    ${p.checkedIn ? '‚úÖ ƒê√£ Check-in' : '‚è≥ Ch·ªù tham gia'}
                                </span>
                            </td>
                            <td class="small text-muted">${new Date(p.registeredAt).toLocaleDateString('vi-VN')}</td>
                        </tr>
                    `).reverse().join(''); // Hi·ªán ng∆∞·ªùi m·ªõi ƒëƒÉng k√Ω l√™n ƒë·∫ßu
                })
                .catch(() => console.error("Kh√¥ng th·ªÉ t·∫£i danh s√°ch"));
        }

        // T·∫£i d·ªØ li·ªáu ban ƒë·∫ßu
        loadParticipants();

        // T·ª± ƒë·ªông c·∫≠p nh·∫≠t sau m·ªói 30 gi√¢y ƒë·ªÉ L·ªôc kh√¥ng c·∫ßn nh·∫•n F5
        setInterval(loadParticipants, 30000);
    </script>
</body>
</html>

